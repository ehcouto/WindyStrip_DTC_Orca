/*
 * MclPwm_prv.h
 *
 *  Created on: 17 apr 2018
 *      Author: lab.motori
 */

#ifndef MCLPWM_PRV_H_
#define MCLPWM_PRV_H_

#include "mci_prm.h"
#include "MclBasicTypes.h"
#ifndef CURR_TO_IQ
    #define CURR_TO_IQ(current)         (sint16)(((current) * 32768.0f)/BASE_CURRENT)
#endif
////////////////////////  INVERTER COMPENSATION TABLE //////////////////

#if (1)//(WINDY_STRIP_BOARD == 1) //Always use Windy Strip board deadtime table for now. TODO:FAGNAL
MATHCALC_LUT_F_TYPE Dutycycle_By_Current_LUT[] =
{
         // Input current            Output - Ratio to scale in dc bus
        { -4.000f,       -0.0232194961800000f  },
        { -3.875f,       -0.0232327112901724f  },
        { -3.750f,       -0.0231836238555470f  },
        { -3.625f,       -0.0231014283579975f  },
        { -3.500f,       -0.0230069008260000f  },
        { -3.375f,       -0.0229132005052368f  },
        { -3.250f,       -0.0228266715292032f  },
        { -3.125f,       -0.0227476445898120f  },
        { -3.000f,       -0.0226712386080000f  },
        { -2.875f,       -0.0225881624043325f  },
        { -2.750f,       -0.0224855163696094f  },
        { -2.625f,       -0.0223475941354703f  },
        { -2.500f,       -0.0221566842450000f  },
        { -2.375f,       -0.0218938718233345f  },
        { -2.250f,       -0.0215398402482657f  },
        { -2.125f,       -0.0210756728208472f  },
        { -2.000f,       -0.0204836544360000f  },
        { -1.875f,       -0.0197480732531177f  },
        { -1.750f,       -0.0188560223666718f  },
        { -1.625f,       -0.0182176406315157f  },
        { -1.500f,       -0.0175060990260000f  },
        { -1.375f,       -0.0169285195539843f  },
        { -1.250f,       -0.0163874304123750f  },
        { -1.125f,       -0.0157853597980782f  },
        { -1.000f,       -0.0150248359080000f  },
        { -0.875f,       -0.0140360554949062f  },
        { -0.750f,       -0.0137160000000000f  },
        { -0.625f,       -0.0135000000000000f  },
        { -0.500f,       -0.0132840000000000f  },
        { -0.375f,       -0.0129600000000000f  },
        { -0.250f,       -0.0118800000000000f  },
        { -0.125f,       -0.0108000000000000f  },
        {  0.000f,        0.0000000000000000f  },
        {  0.125f,        0.0108000000000000f  },
        {  0.250f,        0.0118800000000000f  },
        {  0.375f,        0.0129600000000000f  },
        {  0.500f,        0.0133920000000000f  },
        {  0.625f,        0.0136080000000000f  },
        {  0.750f,        0.0150983233189453f  },
        {  0.875f,        0.0162392548183867f  },
        {  1.000f,        0.0168092172000000f  },
        {  1.125f,        0.0174608718187500f  },
        {  1.250f,        0.0182512662750000f  },
        {  1.375f,        0.0191288643187500f  },
        {  1.500f,        0.0200421297000000f  },
        {  1.625f,        0.0209395261687500f  },
        {  1.750f,        0.0209784249210936f  },
        {  1.875f,        0.0219663169543213f  },
        {  2.000f,        0.0225600984000000f  },
        {  2.125f,        0.0228955182853270f  },
        {  2.250f,        0.0230768420132812f  },
        {  2.375f,        0.0231805799729735f  },
        {  2.500f,        0.0232592161499999f  },
        {  2.625f,        0.0233449367367920f  },
        {  2.750f,        0.0234533587429686f  },
        {  2.875f,        0.0235872586056885f  },
        {  3.000f,        0.0237403007999998f  },
        {  3.125f,        0.0239007664491945f  },
        {  3.250f,        0.0240552819351561f  },
        {  3.375f,        0.0241925475087159f  },
        {  3.500f,        0.0243070658999994f  },
        {  3.625f,        0.0244028709287834f  },
        {  3.750f,        0.0244972561148435f  },
        {  3.875f,        0.0246245032883053f  },
        {  4.000f,        0.0248396111999998f  },
};
#elif(WINDY_INTERNATION_BOARD == 1)
MATHCALC_LUT_F_TYPE Dutycycle_By_Current_LUT[] =
{
{-8.0f,	-0.02738198985f},
{-7.9f,	-0.02727850659f},
{-7.8f,	-0.02717502333f},
{-7.7f,	-0.02707154007f},
{-7.6f,	-0.02696805682f},
{-7.5f,	-0.02686457356f},
{-7.4f,	-0.02676109030f},
{-7.3f,	-0.02665760704f},
{-7.2f,	-0.02655412379f},
{-7.1f,	-0.02645064053f},
{-7.0f,	-0.02634715727f},
{-6.9f,	-0.02624367401f},
{-6.8f,	-0.02614019075f},
{-6.7f,	-0.02603670750f},
{-6.6f,	-0.02593322424f},
{-6.5f,	-0.02582974098f},
{-6.4f,	-0.02572625772f},
{-6.3f,	-0.02562277446f},
{-6.2f,	-0.02551929121f},
{-6.1f,	-0.02541580795f},
{-6.0f,	-0.02531232469f},
{-5.9f,	-0.02520884143f},
{-5.8f,	-0.02510535818f},
{-5.7f,	-0.02500187492f},
{-5.6f,	-0.02489839166f},
{-5.5f,	-0.02479490840f},
{-5.4f,	-0.02469142514f},
{-5.3f,	-0.02458794189f},
{-5.2f,	-0.02448445863f},
{-5.1f,	-0.02438097537f},
{-5.0f,	-0.02427749211f},
{-4.9f,	-0.02417400885f},
{-4.8f,	-0.02407052560f},
{-4.7f,	-0.02396704234f},
{-4.6f,	-0.02386355908f},
{-4.5f,	-0.02376007582f},
{-4.4f,	-0.02365659256f},
{-4.3f,	-0.02355310931f},
{-4.2f,	-0.02344962605f},
{-4.1f,	-0.02334614279f},
{-4.0f,	-0.02324265953f},
{-3.9f,	-0.02313917628f},
{-3.8f,	-0.02303569302f},
{-3.7f,	-0.02293220976f},
{-3.6f,	-0.02282872650f},
{-3.5f,	-0.02272524324f},
{-3.4f,	-0.02262175999f},
{-3.3f,	-0.02251827673f},
{-3.2f,	-0.02241479347f},
{-3.1f,	-0.02231131021f},
{-3.0f,	-0.02220782695f},
{-2.9f,	-0.02210434370f},
{-2.8f,	-0.02200086044f},
{-2.7f,	-0.02189737718f},
{-2.6f,	-0.02179389392f},
{-2.5f,	-0.02169041067f},
{-2.4f,	-0.02158692741f},
{-2.3f,	-0.02148344415f},
{-2.2f,	-0.02137996089f},
{-2.1f,	-0.02127647763f},
{-2.0f,	-0.02117299437f},
{-1.9f,	-0.02106951111f},
{-1.8f,	-0.02096602784f},
{-1.7f,	-0.02086254453f},
{-1.6f,	-0.02075906111f},
{-1.5f,	-0.02065557735f},
{-1.4f,	-0.02055209254f},
{-1.3f,	-0.02044860443f},
{-1.2f,	-0.02034510605f},
{-1.1f,	-0.02024157562f},
{-1.0f,	-0.02013794521f},
{-0.9f,	-0.02003400294f},
{-0.8f,	-0.01992908794f},
{-0.7f,	-0.01982113873f},
{-0.6f,	-0.01970372516f},
{-0.5f,	-0.01955679001f},
{-0.4f,	-0.01931777028f},
{-0.3f,	-0.01879151742f},
{-0.2f,	-0.01736931806f},
{-0.1f,	-0.01315245449f},
{0.0f,	-0.0002183873226f},
{0.1f,	0.01315245449f},
{0.2f,	0.01736931806f},
{0.3f,	0.01879151742f},
{0.4f,	0.01931777028f},
{0.5f,	0.01955679001f},
{0.6f,	0.01970372516f},
{0.7f,	0.01982113873f},
{0.8f,	0.01992908794f},
{0.9f,	0.02003400294f},
{1.0f,	0.02013794521f},
{1.1f,	0.02024157562f},
{1.2f,	0.02034510605f},
{1.3f,	0.02044860443f},
{1.4f,	0.02055209254f},
{1.5f,	0.02065557735f},
{1.6f,	0.02075906111f},
{1.7f,	0.02086254453f},
{1.8f,	0.02096602784f},
{1.9f,	0.02106951111f},
{2.0f,	0.02117299437f},
{2.1f,	0.02127647763f},
{2.2f,	0.02137996089f},
{2.3f,	0.02148344415f},
{2.4f,	0.02158692741f},
{2.5f,	0.02169041067f},
{2.6f,	0.02179389392f},
{2.7f,	0.02189737718f},
{2.8f,	0.02200086044f},
{2.9f,	0.02210434370f},
{3.0f,	0.02220782695f},
{3.1f,	0.02231131021f},
{3.2f,	0.02241479347f},
{3.3f,	0.02251827673f},
{3.4f,	0.02262175999f},
{3.5f,	0.02272524324f},
{3.6f,	0.02282872650f},
{3.7f,	0.02293220976f},
{3.8f,	0.02303569302f},
{3.9f,	0.02313917628f},
{4.0f,	0.02324265953f},
{4.1f,	0.02334614279f},
{4.2f,	0.02344962605f},
{4.3f,	0.02355310931f},
{4.4f,	0.02365659256f},
{4.5f,	0.02376007582f},
{4.6f,	0.02386355908f},
{4.7f,	0.02396704234f},
{4.8f,	0.02407052560f},
{4.9f,	0.02417400885f},
{5.0f,	0.02427749211f},
{5.1f,	0.02438097537f},
{5.2f,	0.02448445863f},
{5.3f,	0.02458794189f},
{5.4f,	0.02469142514f},
{5.5f,	0.02479490840f},
{5.6f,	0.02489839166f},
{5.7f,	0.02500187492f},
{5.8f,	0.02510535818f},
{5.9f,	0.02520884143f},
{6.0f,	0.02531232469f},
{6.1f,	0.02541580795f},
{6.2f,	0.02551929121f},
{6.3f,	0.02562277446f},
{6.4f,	0.02572625772f},
{6.5f,	0.02582974098f},
{6.6f,	0.02593322424f},
{6.7f,	0.02603670750f},
{6.8f,	0.02614019075f},
{6.9f,	0.02624367401f},
{7.0f,	0.02634715727f},
{7.1f,	0.02645064053f},
{7.2f,	0.02655412379f},
{7.3f,	0.02665760704f},
{7.4f,	0.02676109030f},
{7.5f,	0.02686457356f},
{7.6f,	0.02696805682f},
{7.7f,	0.02707154007f},
{7.8f,	0.02717502333f},
{7.9f,	0.02727850659f},
{8.0f,  0.02738198985f}

};

#if 0// Mitsubishi IPM for JANUS
MATHCALC_LUT_F_TYPE Dutycycle_By_Current_LUT[] =
{

{-8.0f,	-0.03007082132f},
{-7.9f,	-0.02992806721f},
{-7.8f,	-0.02978531309f},
{-7.7f,	-0.02964255898f},
{-7.6f,	-0.02949980487f},
{-7.5f,	-0.02935705075f},
{-7.4f,	-0.02921429664f},
{-7.3f,	-0.02907154253f},
{-7.2f,	-0.02892878842f},
{-7.1f,	-0.02878603430f},
{-7.0f,	-0.02864328019f},
{-6.9f,	-0.02850052608f},
{-6.8f,	-0.02835777196f},
{-6.7f,	-0.02821501785f},
{-6.6f,	-0.02807226374f},
{-6.5f,	-0.02792950963f},
{-6.4f,	-0.02778675551f},
{-6.3f,	-0.02764400140f},
{-6.2f,	-0.02750124729f},
{-6.1f,	-0.02735849317f},
{-6.0f,	-0.02721573906f},
{-5.9f,	-0.02707298495f},
{-5.8f,	-0.02693023083f},
{-5.7f,	-0.02678747672f},
{-5.6f,	-0.02664472261f},
{-5.5f,	-0.02650196850f},
{-5.4f,	-0.02635921438f},
{-5.3f,	-0.02621646027f},
{-5.2f,	-0.02607370616f},
{-5.1f,	-0.02593095204f},
{-5.0f,	-0.02578819793f},
{-4.9f,	-0.02564544382f},
{-4.8f,	-0.02550268971f},
{-4.7f,	-0.02535993559f},
{-4.6f,	-0.02521718148f},
{-4.5f,	-0.02507442737f},
{-4.4f,	-0.02493167325f},
{-4.3f,	-0.02478891914f},
{-4.2f,	-0.02464616503f},
{-4.1f,	-0.02450341092f},
{-4.0f,	-0.02436065680f},
{-3.9f,	-0.02421790269f},
{-3.8f,	-0.02407514858f},
{-3.7f,	-0.02393239446f},
{-3.6f,	-0.02378964035f},
{-3.5f,	-0.02364688624f},
{-3.4f,	-0.02350413212f},
{-3.3f,	-0.02336137801f},
{-3.2f,	-0.02321862390f},
{-3.1f,	-0.02307586979f},
{-3.0f,	-0.02293311567f},
{-2.9f,	-0.02279036156f},
{-2.8f,	-0.02264760745f},
{-2.7f,	-0.02250485333f},
{-2.6f,	-0.02236209922f},
{-2.5f,	-0.02221934510f},
{-2.4f,	-0.02207659098f},
{-2.3f,	-0.02193383685f},
{-2.2f,	-0.02179108270f},
{-2.1f,	-0.02164832848f},
{-2.0f,	-0.02150557413f},
{-1.9f,	-0.02136281942f},
{-1.8f,	-0.02122006388f},
{-1.7f,	-0.02107730632f},
{-1.6f,	-0.02093454390f},
{-1.5f,	-0.02079176972f},
{-1.4f,	-0.02064896719f},
{-1.3f,	-0.02050609621f},
{-1.2f,	-0.02036306006f},
{-1.1f,	-0.02021962526f},
{-1.0f,	-0.02007522836f},
{-0.9f,	-0.01992850949f},
{-0.8f,	-0.01977618670f},
{-0.7f,	-0.01961033921f},
{-0.6f,	-0.01941185076f},
{-0.5f,	-0.01913458548f},
{-0.4f,	-0.01866719753f},
{-0.3f,	-0.01774096103f},
{-0.2f,	-0.01570732375f},
{-0.1f,	-0.01100104763f},
{0.0f,	-0.0001554663419},
{0.1f,	0.011001047630},
{0.2f,	0.01570732375f},
{0.3f,	0.01774096103f},
{0.4f,	0.01866719753f},
{0.5f,	0.01913458548f},
{0.6f,	0.01941185076f},
{0.7f,	0.01961033921f},
{0.8f,	0.01977618670f},
{0.9f,	0.01992850949f},
{1.0f,	0.02007522836f},
{1.1f,	0.02021962526f},
{1.2f,	0.02036306006f},
{1.3f,	0.02050609621f},
{1.4f,	0.02064896719f},
{1.5f,	0.02079176972f},
{1.6f,	0.02093454390f},
{1.7f,	0.02107730632f},
{1.8f,	0.02122006388f},
{1.9f,	0.02136281942f},
{2.0f,	0.02150557413f},
{2.1f,	0.02164832848f},
{2.2f,	0.02179108270f},
{2.3f,	0.02193383685f},
{2.4f,	0.02207659098f},
{2.5f,	0.02221934510f},
{2.6f,	0.02236209922f},
{2.7f,	0.02250485333f},
{2.8f,	0.02264760745f},
{2.9f,	0.02279036156f},
{3.0f,	0.02293311567f},
{3.1f,	0.02307586979f},
{3.2f,	0.02321862390f},
{3.3f,	0.02336137801f},
{3.4f,	0.02350413212f},
{3.5f,	0.02364688624f},
{3.6f,	0.02378964035f},
{3.7f,	0.02393239446f},
{3.8f,	0.02407514858f},
{3.9f,	0.02421790269f},
{4.0f,	0.02436065680f},
{4.1f,	0.02450341092f},
{4.2f,	0.02464616503f},
{4.3f,	0.02478891914f},
{4.4f,	0.02493167325f},
{4.5f,	0.02507442737f},
{4.6f,	0.02521718148f},
{4.7f,	0.02535993559f},
{4.8f,	0.02550268971f},
{4.9f,	0.02564544382f},
{5.0f,	0.02578819793f},
{5.1f,	0.02593095204f},
{5.2f,	0.02607370616f},
{5.3f,	0.02621646027f},
{5.4f,	0.02635921438f},
{5.5f,	0.02650196850f},
{5.6f,	0.02664472261f},
{5.7f,	0.02678747672f},
{5.8f,	0.02693023083f},
{5.9f,	0.02707298495f},
{6.0f,	0.02721573906f},
{6.1f,	0.02735849317f},
{6.2f,	0.02750124729f},
{6.3f,	0.02764400140f},
{6.4f,	0.02778675551f},
{6.5f,	0.02792950963f},
{6.6f,	0.02807226374f},
{6.7f,	0.02821501785f},
{6.8f,	0.02835777196f},
{6.9f,	0.02850052608f},
{7.0f,	0.02864328019f},
{7.1f,	0.02878603430f},
{7.2f,	0.02892878842f},
{7.3f,	0.02907154253f},
{7.4f,	0.02921429664f},
{7.5f,	0.02935705075f},
{7.6f,	0.02949980487f},
{7.7f,	0.02964255898f},
{7.8f,	0.02978531309f},
{7.9f,	0.02992806721f},
{8.0f,	0.03007082132f},
};

#endif

#else
    #error "Need to define a board"
#endif


float32 step_inv_pwm_comp   = 1.0f/0.125f;
sint32 sizeof_inv_comp_lut = sizeof(Dutycycle_By_Current_LUT)/sizeof(MATHCALC_LUT_F_TYPE);



#endif /* MCLPWM_PRV_H_ */
